name: digikam
base: core18

version: '6.4.0'
adopt-info: digikam

grade: stable
confinement: strict

apps:
  digikam:
    environment:
      DK_PLUGIN_PATH: "$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/qt5/plugins/digikam"
    command: usr/bin/digikam
    common-id: org.kde.digikam.desktop
    extensions:
    - kde-neon
    plugs:
    - camera
    - home
    - mount-observe
    - network
    - network-bind
    - opengl
    - pulseaudio
    - removable-media
    - udisks2

parts:
  digikam:
    source: https://download.kde.org/stable/digikam/$SNAPCRAFT_PROJECT_VERSION/digikam-$SNAPCRAFT_PROJECT_VERSION.tar.xz
    source-checksum: "sha256/775012ff515bdd25a0b894c95bf5d33e7122b523da9c0f3af260ec3eff498d6f"
    plugin: cmake
    stage-packages:
    - libexif12
    - libgphoto2-6
    - libgphoto2-port12
    - libjpeg8
    - libjpeg-turbo8
    - liblensfun1
    - liblqr-1-0
    - libltdl7
    - libopencv-core3.2
    - libopencv-imgproc3.2
    - libopencv-objdetect3.2
    - libtbb2
    build-packages:
    - bison
    - ccache
    - doxygen
    - g++
    - libboost-graph-dev
    - libegl1-mesa-dev
    - libeigen3-dev
    - libexpat1-dev
    - libfl-dev
    - libglib2.0-dev
    - libjpeg-dev
    - liblensfun-dev
    - libmagickcore-dev
    - libopencv-dev
    - libpng-dev
    - libsane-dev
    - libsqlite3-dev
    - libtiff-dev
    - libxslt1-dev
    - ninja-build
    build-snaps:
    - kde-frameworks-5-core18-sdk
    build-environment:
    - PATH: "/usr/lib/ccache:$PATH"
    configflags:
    - -GNinja
    - -DCMAKE_INSTALL_PREFIX=/usr
    - -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
    - -DBUILD_TESTING=ON
    - -DDIGIKAMSC_CHECKOUT_PO=OFF
    - -DDIGIKAMSC_CHECKOUT_DOC=OFF
    - -DDIGIKAMSC_COMPILE_PO=OFF
    - -DDIGIKAMSC_COMPILE_DOC=ON
    - -DDIGIKAMSC_COMPILE_DIGIKAM=ON
    - -DENABLE_KFILEMETADATASUPPORT=OFF
    - -DENABLE_AKONADICONTACTSUPPORT=OFF
    - -DENABLE_MYSQLSUPPORT=OFF
    - -DENABLE_INTERNALMYSQL=OFF
    - -DENABLE_MEDIAPLAYER=OFF
    - -DENABLE_LCMS2=ON
    - -DDIGIKAMSC_USE_PRIVATE_KDEGRAPHICS=OFF
    - -DENABLE_DBUS=ON
    - -DENABLE_APPSTYLES=ON
    - -DENABLE_QWEBENGINE=OFF
    - -DENABLE_FACESENGINE_DNN=ON
    - -Wno-dev
    parse-info:
    - usr/share/metainfo/org.kde.digikam.appdata.xml

